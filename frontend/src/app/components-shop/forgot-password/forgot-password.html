<body>
  <div class="background"></div>

  <header class="top-bar">
    <div class="top-links">
      <a routerLink="/login" class="back">BACK</a>
      <div class="lang">ENGLISH ▼</div>
    </div>
  </header>

  <div class="login-container">
    <img src="/public/image/logo.svg" alt="MotoGP" class="logo">

    <div class="form-box">
      <div class="tabs">
        <a class="tab" routerLink="/register" routerLinkActive="active">REGISTER</a>
        <a class="tab" routerLink="/login" routerLinkActive="active">LOGIN</a>
      </div>

      <!-- Step 1: Enter Email -->
      <div *ngIf="step === 'email'">
        <h2 style="color: white; margin-bottom: 20px;">Quên mật khẩu</h2>
        <p style="color: #ccc; margin-bottom: 30px; font-size: 14px;">Nhập email của bạn để nhận mã OTP</p>

        <form [formGroup]="emailForm" (ngSubmit)="onSendEmail()">
          <label>Email</label>
          <input
            type="email"
            formControlName="email"
            class="form-control"
            placeholder="Enter your email"
            [disabled]="isLoading"
          />
          <div class="text-danger" *ngIf="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
            Vui lòng nhập email hợp lệ
          </div>

          <button
            type="submit"
            class="login-btn"
            [disabled]="emailForm.invalid || isLoading"
          >
            {{ isLoading ? 'Đang gửi...' : 'Gửi mã OTP' }}
          </button>
        </form>
      </div>

      <!-- Step 2: Verify OTP and New Password -->
      <div *ngIf="step === 'verify'">
        <h2 style="color: white; margin-bottom: 20px;">Xác nhận OTP</h2>
        <p style="color: #ccc; margin-bottom: 30px; font-size: 14px;">Nhập mã OTP và mật khẩu mới</p>
        <p style="color: #999; margin-bottom: 30px; font-size: 12px;">Email: {{ email }}</p>

        <form [formGroup]="verifyForm" (ngSubmit)="onVerifyOTP()">
          <label>Mã OTP</label>
          <input
            type="text"
            formControlName="otp"
            class="form-control"
            placeholder="Enter 6-digit OTP"
            maxlength="6"
            pattern="[0-9]{6}"
            [disabled]="isLoading"
          />
          <div class="text-danger" *ngIf="verifyForm.get('otp')?.invalid && verifyForm.get('otp')?.touched">
            Mã OTP phải có 6 chữ số
          </div>

          <label>Mật khẩu mới</label>
          <div class="password-box">
            <input
              type="password"
              formControlName="password"
              id="newPassword"
              class="form-control"
              placeholder="Enter new password"
              [disabled]="isLoading"
            />
            <span class="show" (click)="togglePassword('newPassword')">show</span>
          </div>
          <div class="text-danger" *ngIf="verifyForm.get('password')?.invalid && verifyForm.get('password')?.touched">
            Mật khẩu phải có ít nhất 6 ký tự
          </div>

          <label>Xác nhận mật khẩu</label>
          <div class="password-box">
            <input
              type="password"
              formControlName="confirmPassword"
              id="confirmNewPassword"
              class="form-control"
              placeholder="Confirm new password"
              [disabled]="isLoading"
            />
            <span class="show" (click)="togglePassword('confirmNewPassword')">show</span>
          </div>
          <div class="text-danger" *ngIf="verifyForm.get('confirmPassword')?.invalid && verifyForm.get('confirmPassword')?.touched">
            Vui lòng xác nhận mật khẩu
          </div>
          <div class="text-danger" *ngIf="verifyForm.get('password')?.value && verifyForm.get('confirmPassword')?.value && verifyForm.get('password')?.value !== verifyForm.get('confirmPassword')?.value">
            Mật khẩu xác nhận không khớp
          </div>

          <button
            type="button"
            class="login-btn"
            style="margin-bottom: 10px; background: #666;"
            (click)="backToEmail()"
            [disabled]="isLoading"
          >
            Quay lại
          </button>

          <button
            type="submit"
            class="login-btn"
            [disabled]="verifyForm.invalid || isLoading"
          >
            {{ isLoading ? 'Đang xử lý...' : 'Đặt lại mật khẩu' }}
          </button>
        </form>
      </div>
    </div>

    <p class="footer-text">AN ACCOUNT FOR RACING TOGETHER</p>

    <div class="devices">
      <div class="device"></div>
      <div class="device"></div>
      <div class="device"></div>
      <div class="device"></div>
    </div>
  </div>

  <footer>
    © 2025 Dorna Sports. All rights reserved.
  </footer>
</body>
